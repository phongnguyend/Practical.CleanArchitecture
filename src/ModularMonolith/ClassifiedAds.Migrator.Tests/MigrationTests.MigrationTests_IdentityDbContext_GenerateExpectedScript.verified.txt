IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
GO

BEGIN TRANSACTION;
CREATE TABLE [DataProtectionKeys] (
    [Id] int NOT NULL IDENTITY,
    [FriendlyName] nvarchar(max) NULL,
    [Xml] nvarchar(max) NULL,
    CONSTRAINT [PK_DataProtectionKeys] PRIMARY KEY ([Id])
);

CREATE TABLE [Roles] (
    [Id] uniqueidentifier NOT NULL DEFAULT (newsequentialid()),
    [Name] nvarchar(max) NULL,
    [NormalizedName] nvarchar(max) NULL,
    [ConcurrencyStamp] nvarchar(max) NULL,
    [RowVersion] rowversion NULL,
    [CreatedDateTime] datetimeoffset NOT NULL,
    [UpdatedDateTime] datetimeoffset NULL,
    CONSTRAINT [PK_Roles] PRIMARY KEY ([Id])
);

CREATE TABLE [Users] (
    [Id] uniqueidentifier NOT NULL DEFAULT (newsequentialid()),
    [UserName] nvarchar(max) NULL,
    [NormalizedUserName] nvarchar(max) NULL,
    [Email] nvarchar(max) NULL,
    [NormalizedEmail] nvarchar(max) NULL,
    [EmailConfirmed] bit NOT NULL,
    [PasswordHash] nvarchar(max) NULL,
    [PhoneNumber] nvarchar(max) NULL,
    [PhoneNumberConfirmed] bit NOT NULL,
    [TwoFactorEnabled] bit NOT NULL,
    [ConcurrencyStamp] nvarchar(max) NULL,
    [SecurityStamp] nvarchar(max) NULL,
    [LockoutEnabled] bit NOT NULL,
    [LockoutEnd] datetimeoffset NULL,
    [AccessFailedCount] int NOT NULL,
    [Auth0UserId] nvarchar(max) NULL,
    [AzureAdB2CUserId] nvarchar(max) NULL,
    [RowVersion] rowversion NULL,
    [CreatedDateTime] datetimeoffset NOT NULL,
    [UpdatedDateTime] datetimeoffset NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([Id])
);

CREATE TABLE [RoleClaims] (
    [Id] uniqueidentifier NOT NULL DEFAULT (newsequentialid()),
    [Type] nvarchar(max) NULL,
    [Value] nvarchar(max) NULL,
    [RoleId] uniqueidentifier NULL,
    [RowVersion] rowversion NULL,
    [CreatedDateTime] datetimeoffset NOT NULL,
    [UpdatedDateTime] datetimeoffset NULL,
    CONSTRAINT [PK_RoleClaims] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_RoleClaims_Roles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [Roles] ([Id]) ON DELETE CASCADE
);

CREATE TABLE [UserClaims] (
    [Id] uniqueidentifier NOT NULL DEFAULT (newsequentialid()),
    [Type] nvarchar(max) NULL,
    [Value] nvarchar(max) NULL,
    [UserId] uniqueidentifier NULL,
    [RowVersion] rowversion NULL,
    [CreatedDateTime] datetimeoffset NOT NULL,
    [UpdatedDateTime] datetimeoffset NULL,
    CONSTRAINT [PK_UserClaims] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_UserClaims_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE CASCADE
);

CREATE TABLE [UserRoles] (
    [Id] uniqueidentifier NOT NULL DEFAULT (newsequentialid()),
    [UserId] uniqueidentifier NOT NULL,
    [RoleId] uniqueidentifier NOT NULL,
    [RowVersion] rowversion NULL,
    [CreatedDateTime] datetimeoffset NOT NULL,
    [UpdatedDateTime] datetimeoffset NULL,
    CONSTRAINT [PK_UserRoles] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_UserRoles_Roles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [Roles] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_UserRoles_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE CASCADE
);

CREATE TABLE [UserTokens] (
    [Id] uniqueidentifier NOT NULL DEFAULT (newsequentialid()),
    [UserId] uniqueidentifier NOT NULL,
    [LoginProvider] nvarchar(max) NULL,
    [TokenName] nvarchar(max) NULL,
    [TokenValue] nvarchar(max) NULL,
    [RowVersion] rowversion NULL,
    [CreatedDateTime] datetimeoffset NOT NULL,
    [UpdatedDateTime] datetimeoffset NULL,
    CONSTRAINT [PK_UserTokens] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_UserTokens_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE CASCADE
);

IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'AccessFailedCount', N'Auth0UserId', N'AzureAdB2CUserId', N'ConcurrencyStamp', N'CreatedDateTime', N'Email', N'EmailConfirmed', N'LockoutEnabled', N'LockoutEnd', N'NormalizedEmail', N'NormalizedUserName', N'PasswordHash', N'PhoneNumber', N'PhoneNumberConfirmed', N'SecurityStamp', N'TwoFactorEnabled', N'UpdatedDateTime', N'UserName') AND [object_id] = OBJECT_ID(N'[Users]'))
    SET IDENTITY_INSERT [Users] ON;
INSERT INTO [Users] ([Id], [AccessFailedCount], [Auth0UserId], [AzureAdB2CUserId], [ConcurrencyStamp], [CreatedDateTime], [Email], [EmailConfirmed], [LockoutEnabled], [LockoutEnd], [NormalizedEmail], [NormalizedUserName], [PasswordHash], [PhoneNumber], [PhoneNumberConfirmed], [SecurityStamp], [TwoFactorEnabled], [UpdatedDateTime], [UserName])
VALUES ('12837d3d-793f-ea11-becb-5cea1d05f660', 0, NULL, NULL, NULL, '0001-01-01T00:00:00.0000000+00:00', N'phong@gmail.com', CAST(0 AS bit), CAST(1 AS bit), NULL, N'PHONG@GMAIL.COM', N'PHONG@GMAIL.COM', N'AQAAAAEAACcQAAAAELBcKuXWkiRQEYAkD/qKs9neac5hxWs3bkegIHpGLtf+zFHuKnuI3lBqkWO9TMmFAQ==', NULL, CAST(0 AS bit), N'5M2QLL65J6H6VFIS7VZETKXY27KNVVYJ', CAST(0 AS bit), NULL, N'phong@gmail.com');
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'AccessFailedCount', N'Auth0UserId', N'AzureAdB2CUserId', N'ConcurrencyStamp', N'CreatedDateTime', N'Email', N'EmailConfirmed', N'LockoutEnabled', N'LockoutEnd', N'NormalizedEmail', N'NormalizedUserName', N'PasswordHash', N'PhoneNumber', N'PhoneNumberConfirmed', N'SecurityStamp', N'TwoFactorEnabled', N'UpdatedDateTime', N'UserName') AND [object_id] = OBJECT_ID(N'[Users]'))
    SET IDENTITY_INSERT [Users] OFF;

CREATE INDEX [IX_RoleClaims_RoleId] ON [RoleClaims] ([RoleId]);

CREATE INDEX [IX_UserClaims_UserId] ON [UserClaims] ([UserId]);

CREATE INDEX [IX_UserRoles_RoleId] ON [UserRoles] ([RoleId]);

CREATE INDEX [IX_UserRoles_UserId] ON [UserRoles] ([UserId]);

CREATE INDEX [IX_UserTokens_UserId] ON [UserTokens] ([UserId]);

INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20231215102238_Init', N'9.0.1');

CREATE TABLE [UserLogins] (
    [Id] uniqueidentifier NOT NULL DEFAULT (newsequentialid()),
    [UserId] uniqueidentifier NOT NULL,
    [LoginProvider] nvarchar(max) NULL,
    [ProviderKey] nvarchar(max) NULL,
    [ProviderDisplayName] nvarchar(max) NULL,
    [RowVersion] rowversion NULL,
    [CreatedDateTime] datetimeoffset NOT NULL,
    [UpdatedDateTime] datetimeoffset NULL,
    CONSTRAINT [PK_UserLogins] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_UserLogins_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE CASCADE
);

CREATE INDEX [IX_UserLogins_UserId] ON [UserLogins] ([UserId]);

INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250222002844_Init1', N'9.0.1');

COMMIT;
GO

